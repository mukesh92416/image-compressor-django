<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="google-site-verification" content="kPRJuj7lTPK0JA27ad0rych4BNNp8ZHY6vVjxJOZMzI" />


    <meta charset="UTF-8">
    <meta name="google-adsense-account" content="ca-pub-7892039727629393">
    <title>Image Compressor – Reduce Image Size Online</title>

    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>

<div class="wrapper">
    <div class="card">

        <h1>Image Compressor</h1>
        <p class="subtitle">Compress images to exact KB without losing dimensions</p>

        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}

            {% if error %}
                <div class="error">{{ error }}</div>
            {% endif %}

            <label class="label">Upload Image</label>
            <input type="file" name="image" required>

            <label class="label">Target Size (KB)</label>
            <input
                type="number"
                name="target_kb"
                placeholder="e.g. 50"
                min="10"
                required
            >
<div class="format-toggle">
    <label>
        <input type="radio" name="format" value="JPEG" checked>
        JPG
    </label>

    <label>
        <input type="radio" name="format" value="PNG">
        PNG
    </label>
</div>

           <button type="submit" id="submitBtn">
    <span class="btn-text">Compress Image</span>
    <span class="loader"></span>
</button>

        </form>

        <div class="note">
            Supported formats: JPG, PNG • Free & Secure
        </div>

    </div>
</div>
<script>
const form = document.getElementById("compressForm");
const btn = document.getElementById("submitBtn");

form.addEventListener("submit", async (e) => {
    e.preventDefault(); // STOP normal form submit

    btn.classList.add("loading");
    btn.disabled = true;

    const formData = new FormData(form);

    try {
        const response = await fetch("/", {
            method: "POST",
            body: formData,
        });

        if (!response.ok) {
            throw new Error("Compression failed");
        }

        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);

        const a = document.createElement("a");
        a.href = url;

        // Try to get filename from headers
        const disposition = response.headers.get("Content-Disposition");
        if (disposition && disposition.includes("filename=")) {
            a.download = disposition.split("filename=")[1].replace(/"/g, "");
        } else {
            a.download = "compressed_image";
        }

        document.body.appendChild(a);
        a.click();
        a.remove();
        window.URL.revokeObjectURL(url);

    } catch (err) {
        alert("Something went wrong. Please try again.");
    } finally {
        // ✅ THIS IS THE FIX
        btn.classList.remove("loading");
        btn.disabled = false;
    }
});
</script>

<hr>
    <p>
This free online image compressor allows you to reduce image size to exact KB without losing quality.
Supports JPG and PNG formats. Fast, secure, and no files are stored.
</p>
<footer>
    <a href="/about/">About</a> |
    <a href="/privacy/">Privacy Policy</a> |
    <a href="/contact/">Contact</a>
</footer>
<script src="https://pl28651032.effectivegatecpm.com/f1/5d/a9/f15da9f1b87845179f8e886ceebc25be.js"></script>
</body>
</html>
